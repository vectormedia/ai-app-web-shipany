# ShipAny Template Two - 新增页面指南

## 概述

在 ShipAny Template Two 中新增页面需要遵循 **Next.js App Router** 和项目的架构约定。本指南将详细说明如何创建不同类型的页面，包括公开页面、管理页面、认证页面等。

## 快速指南

### 基本步骤

1. **确定页面类型和路由组**
2. **创建页面文件**
3. **配置国际化内容**
4. **添加导航链接**
5. **设置权限控制**（如需要）
6. **更新 SEO 元数据**

## 1. 页面类型和路由组

### 1.1 路由组说明

```
src/app/[locale]/
├── (landing)/     # 公开页面：首页、定价、AI工具等
├── (admin)/       # 管理后台：仪表板、用户管理等
├── (auth)/        # 认证页面：登录、注册
├── (chat)/        # 聊天应用：AI对话界面
└── (docs)/        # 文档页面：帮助、说明文档
```

### 1.2 选择合适的路由组

- **公开页面** → `(landing)/`
- **需要登录的功能页面** → `(landing)/`
- **管理员专用页面** → `(admin)/`
- **认证相关页面** → `(auth)/`
- **聊天功能页面** → `(chat)/`
- **帮助文档页面** → `(docs)/`

## 2. 创建公开页面（Landing）

### 2.1 创建页面文件

**示例：添加 `/about` 关于我们页面**

```typescript
// src/app/[locale]/(landing)/about/page.tsx
import { getTranslations } from 'next-intl/server';
import { getThemePage } from '@/core/theme';
import { getMetadata } from '@/shared/lib/seo';

// SEO 元数据
export const generateMetadata = getMetadata({
  title: 'About Us',
  description: 'Learn about our mission and team',
  keywords: ['about', 'team', 'mission'],
});

// 页面组件
export default async function AboutPage() {
  // 获取国际化内容
  const t = await getTranslations('about');

  // 加载主题页面组件
  const Page = await getThemePage('about');

  // 准备页面数据
  const pageData = {
    hero: t.raw('hero'),
    team: t.raw('team'),
    mission: t.raw('mission'),
  };

  return <Page {...pageData} />;
}
```

### 2.2 创建主题页面组件

```typescript
// src/themes/default/pages/about.tsx
import { AboutHero, TeamSection, MissionSection } from '@/shared/blocks/about';

interface AboutPageProps {
  hero: any;
  team: any;
  mission: any;
}

export default function AboutPage({ hero, team, mission }: AboutPageProps) {
  return (
    <main className="min-h-screen">
      <AboutHero {...hero} />
      <MissionSection {...mission} />
      <TeamSection {...team} />
    </main>
  );
}
```

### 2.3 添加国际化内容

```json
// src/config/locale/messages/en/about.json
{
  "hero": {
    "title": "About ShipAny",
    "description": "We're building the future of AI-powered content creation",
    "image": "/images/about-hero.jpg"
  },
  "mission": {
    "title": "Our Mission",
    "content": "To democratize AI content creation for everyone"
  },
  "team": {
    "title": "Our Team",
    "members": [
      {
        "name": "John Doe",
        "role": "CEO",
        "image": "/images/team/john.jpg"
      }
    ]
  }
}
```

```json
// src/config/locale/messages/zh/about.json
{
  "hero": {
    "title": "关于 ShipAny",
    "description": "我们正在构建 AI 驱动内容创作的未来",
    "image": "/images/about-hero.jpg"
  },
  "mission": {
    "title": "我们的使命",
    "content": "让每个人都能使用 AI 内容创作工具"
  },
  "team": {
    "title": "我们的团队",
    "members": [
      {
        "name": "张三",
        "role": "首席执行官",
        "image": "/images/team/john.jpg"
      }
    ]
  }
}
```

### 2.4 更新导航配置

```json
// src/config/locale/messages/en/landing.json
{
  "header": {
    "nav": [
      { "title": "Home", "href": "/" },
      { "title": "About", "href": "/about" },
      { "title": "Pricing", "href": "/pricing" }
    ]
  }
}
```

## 3. 创建需要认证的页面

### 3.1 用户设置页面示例

```typescript
// src/app/[locale]/(landing)/settings/notifications/page.tsx
import { redirect } from 'next/navigation';
import { getTranslations } from 'next-intl/server';
import { getUserInfo } from '@/shared/models/user';
import { getThemePage } from '@/core/theme';

export default async function NotificationsPage() {
  // 认证检查
  const user = await getUserInfo();
  if (!user) {
    redirect('/sign-in');
  }

  const t = await getTranslations('settings/notifications');
  const Page = await getThemePage('settings/notifications');

  const pageData = {
    user,
    settings: t.raw('settings'),
  };

  return <Page {...pageData} />;
}
```

### 3.2 主题页面组件

```typescript
// src/themes/default/pages/settings/notifications.tsx
import { NotificationSettings } from '@/shared/blocks/settings';

interface NotificationsPageProps {
  user: any;
  settings: any;
}

export default function NotificationsPage({ user, settings }: NotificationsPageProps) {
  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">{settings.title}</h1>
      <NotificationSettings user={user} settings={settings} />
    </div>
  );
}
```

## 4. 创建管理后台页面

### 4.1 管理页面示例

```typescript
// src/app/[locale]/(admin)/admin/analytics/page.tsx
import { notFound } from 'next/navigation';
import { getTranslations } from 'next-intl/server';
import { getUserInfo } from '@/shared/models/user';
import { checkPermission } from '@/shared/models/rbac';
import { getThemePage } from '@/core/theme';

export default async function AnalyticsPage() {
  // 用户认证
  const user = await getUserInfo();
  if (!user) {
    notFound();
  }

  // 权限检查
  const hasPermission = await checkPermission(user.id, 'admin.analytics.read');
  if (!hasPermission) {
    notFound();
  }

  const t = await getTranslations('admin/analytics');
  const Page = await getThemePage('admin/analytics');

  const pageData = {
    analytics: await getAnalyticsData(),
    charts: t.raw('charts'),
  };

  return <Page {...pageData} />;
}
```

### 4.2 添加到管理侧边栏

```json
// src/config/locale/messages/en/admin/sidebar.json
{
  "items": [
    {
      "title": "Dashboard",
      "href": "/admin",
      "icon": "dashboard"
    },
    {
      "title": "Analytics",
      "href": "/admin/analytics",
      "icon": "analytics",
      "permission": "admin.analytics.read"
    }
  ]
}
```

## 5. 创建 API 端点

### 5.1 对应的 API 路由

```typescript
// src/app/api/analytics/overview/route.ts
import { respData, respErr } from '@/shared/lib/resp';
import { getUserInfo } from '@/shared/models/user';
import { checkPermission } from '@/shared/models/rbac';

export async function GET(req: Request) {
  try {
    // 认证检查
    const user = await getUserInfo();
    if (!user) {
      return respErr('Authentication required');
    }

    // 权限检查
    const hasPermission = await checkPermission(user.id, 'admin.analytics.read');
    if (!hasPermission) {
      return respErr('Insufficient permissions');
    }

    // 获取分析数据
    const analytics = await getAnalyticsOverview();

    return respData(analytics);
  } catch (e: any) {
    return respErr(e.message);
  }
}
```

## 6. 创建动态路由页面

### 6.1 动态参数页面

```typescript
// src/app/[locale]/(landing)/blog/[slug]/page.tsx
import { notFound } from 'next/navigation';
import { getTranslations } from 'next-intl/server';
import { getPostBySlug } from '@/shared/models/post';
import { getThemePage } from '@/core/theme';

interface BlogPostPageProps {
  params: Promise<{
    slug: string;
    locale: string;
  }>;
}

export async function generateMetadata({ params }: BlogPostPageProps) {
  const { slug } = await params;
  const post = await getPostBySlug(slug);

  if (!post) {
    return {
      title: 'Post Not Found',
    };
  }

  return {
    title: post.title,
    description: post.description,
    openGraph: {
      title: post.title,
      description: post.description,
      images: [post.image],
    },
  };
}

export default async function BlogPostPage({ params }: BlogPostPageProps) {
  const { slug } = await params;
  const post = await getPostBySlug(slug);

  if (!post) {
    notFound();
  }

  const t = await getTranslations('blog');
  const Page = await getThemePage('blog/post');

  return <Page post={post} t={t} />;
}

// 静态生成路径（可选）
export async function generateStaticParams() {
  const posts = await getAllPublishedPosts();

  return posts.map((post) => ({
    slug: post.slug,
  }));
}
```

## 7. 表单处理页面

### 7.1 表单提交页面

```typescript
// src/app/[locale]/(landing)/contact/page.tsx
import { ContactForm } from '@/shared/blocks/contact';
import { getTranslations } from 'next-intl/server';
import { getThemePage } from '@/core/theme';

export default async function ContactPage() {
  const t = await getTranslations('contact');
  const Page = await getThemePage('contact');

  const pageData = {
    form: t.raw('form'),
    info: t.raw('info'),
  };

  return <Page {...pageData} />;
}
```

### 7.2 对应的表单组件

```typescript
// src/shared/blocks/contact/contact-form.tsx
'use client';

import { useState } from 'react';
import { useRouter } from '@/core/i18n/navigation';

export function ContactForm({ form }: { form: any }) {
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData),
      });

      if (response.ok) {
        router.push('/contact/success');
      }
    } catch (error) {
      console.error('Submit error:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* 表单字段 */}
    </form>
  );
}
```

## 8. 错误处理页面

### 8.1 自定义 404 页面

```typescript
// src/app/[locale]/not-found.tsx
import { getTranslations } from 'next-intl/server';
import { Link } from '@/core/i18n/navigation';

export default async function NotFound() {
  const t = await getTranslations('common');

  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="text-center">
        <h1 className="text-4xl font-bold">{t('notFound.title')}</h1>
        <p className="text-lg mt-4">{t('notFound.description')}</p>
        <Link
          href="/"
          className="mt-6 inline-block bg-primary text-white px-6 py-3 rounded-lg"
        >
          {t('notFound.backHome')}
        </Link>
      </div>
    </div>
  );
}
```

### 8.2 全局错误页面

```typescript
// src/app/[locale]/global-error.tsx
'use client';

export default function GlobalError({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <html>
      <body>
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-center">
            <h2 className="text-2xl font-bold">Something went wrong!</h2>
            <button
              onClick={reset}
              className="mt-4 px-4 py-2 bg-blue-500 text-white rounded"
            >
              Try again
            </button>
          </div>
        </div>
      </body>
    </html>
  );
}
```

## 9. 布局定制

### 9.1 创建自定义布局

```typescript
// src/app/[locale]/(landing)/dashboard/layout.tsx
import { Sidebar } from '@/shared/components/dashboard';
import { getUserInfo } from '@/shared/models/user';
import { redirect } from 'next/navigation';

export default async function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const user = await getUserInfo();

  if (!user) {
    redirect('/sign-in');
  }

  return (
    <div className="flex h-screen">
      <Sidebar user={user} />
      <main className="flex-1 overflow-auto p-6">
        {children}
      </main>
    </div>
  );
}
```

## 10. SEO 和性能优化

### 10.1 静态生成配置

```typescript
// 启用静态生成
export const dynamic = 'force-static';

// 重新验证时间
export const revalidate = 3600; // 1 hour

// 生成静态参数
export async function generateStaticParams() {
  return [
    { locale: 'en' },
    { locale: 'zh' },
  ];
}
```

### 10.2 元数据优化

```typescript
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'Page Title',
  description: 'Page description',
  keywords: ['keyword1', 'keyword2'],
  openGraph: {
    title: 'Page Title',
    description: 'Page description',
    type: 'website',
    url: 'https://example.com/page',
    images: [
      {
        url: 'https://example.com/og-image.jpg',
        width: 1200,
        height: 630,
        alt: 'Page description',
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Page Title',
    description: 'Page description',
    images: ['https://example.com/og-image.jpg'],
  },
};
```

## 11. 测试新页面

### 11.1 功能测试清单

- [ ] 页面正常渲染
- [ ] 国际化内容正确显示
- [ ] 导航链接有效
- [ ] 认证保护正常工作
- [ ] 权限控制有效
- [ ] 表单提交正常
- [ ] SEO 元数据正确
- [ ] 移动端适配良好
- [ ] 性能表现满足要求

### 11.2 测试脚本

```bash
# 开发环境测试
pnpm dev

# 构建测试
pnpm build
pnpm start

# 类型检查
pnpm type-check

# 代码检查
pnpm lint
```

## 12. 常见问题和解决方案

### 12.1 国际化内容不显示

**问题**: 新页面的翻译内容不显示

**解决**:
1. 检查翻译文件路径是否正确
2. 确认 `getTranslations` 命名空间正确
3. 更新 `src/config/locale/index.ts` 中的 `localeMessagesPaths`

```typescript
// src/config/locale/index.ts
export const localeMessagesPaths = [
  'common',
  'landing',
  'about',        // 添加新的翻译命名空间
  // ...
];
```

### 12.2 主题组件加载失败

**问题**: `getThemePage` 找不到组件

**解决**:
1. 确认主题目录结构正确
2. 检查组件文件名和路径匹配
3. 确保组件有默认导出

### 12.3 权限检查不生效

**问题**: 权限保护的页面可以被非法访问

**解决**:
1. 确认 `checkPermission` 调用正确
2. 检查权限数据是否正确配置
3. 验证用户角色分配

## 总结

新增页面的关键步骤：

1. **选择合适的路由组**
2. **创建页面文件和主题组件**
3. **配置国际化内容**
4. **添加必要的认证和权限检查**
5. **更新导航和链接**
6. **优化 SEO 和性能**
7. **全面测试功能**

遵循这些步骤可以确保新页面与项目架构保持一致，并提供良好的用户体验。