# æ€§èƒ½ä¼˜åŒ–æŒ‡å—

## ğŸ“Š å½“å‰ä¼˜åŒ–çŠ¶æ€

### âœ… å·²å¯ç”¨çš„ä¼˜åŒ–

1. **Turbopack** - Next.js æ–°ä¸€ä»£æ‰“åŒ…å·¥å…·
   - å¯ç”¨æ–¹å¼ï¼š`pnpm dev --turbopack`
   - æ¯” Webpack å¿« 10 å€

2. **Turbopack æ–‡ä»¶ç³»ç»Ÿç¼“å­˜**
   - é…ç½®ï¼š`turbopackFileSystemCacheForDev: true`
   - ä½ç½®ï¼š[next.config.mjs:39](../next.config.mjs#L39)

3. **React ç¼–è¯‘å™¨**
   - é…ç½®ï¼š`reactCompiler: true`
   - ä½ç½®ï¼š[next.config.mjs:43](../next.config.mjs#L43)

4. **æ•°æ®åº“å•ä¾‹æ¨¡å¼**
   - é…ç½®ï¼š`DB_SINGLETON_ENABLED="true"`
   - è¿æ¥æ± ï¼š`DB_MAX_CONNECTIONS="10"`
   - ä½ç½®ï¼š[src/core/db/index.ts](../src/core/db/index.ts)

---

## ğŸš€ å·²åº”ç”¨çš„ä¼˜åŒ–

### æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

**ä¿®æ”¹å†…å®¹ï¼š**
```env
# .env.local å’Œ .env.development
DB_MAX_CONNECTIONS = "10"  # ä»é»˜è®¤çš„ 1 å¢åŠ åˆ° 10
```

**æ•ˆæœï¼š**
- å‡å°‘æ•°æ®åº“è¿æ¥å»ºç«‹æ—¶é—´
- æ”¯æŒå¹¶å‘è¯·æ±‚
- å¼€å‘ç¯å¢ƒå“åº”é€Ÿåº¦æå‡

---

## ğŸ” æ€§èƒ½è¯Šæ–­æ–¹æ³•

### 1. æµ‹é‡é¡µé¢åŠ è½½æ—¶é—´

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹ä»¥ä¸‹æŒ‡æ ‡ï¼š

#### Chrome DevTools - Network é¢æ¿

1. æ‰“å¼€ Chrome DevToolsï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æŸ¥çœ‹æœ€ä¸‹æ–¹çš„ç»Ÿè®¡ä¿¡æ¯ï¼š
   - **DOMContentLoaded**: æ–‡æ¡£åŠ è½½æ—¶é—´ï¼ˆåº”è¯¥ < 1ç§’ï¼‰
   - **Load**: é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´ï¼ˆåº”è¯¥ < 2ç§’ï¼‰
   - **Finish**: æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆæ—¶é—´

#### Chrome DevTools - Performance é¢æ¿

1. æ‰“å¼€ Chrome DevToolsï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° **Performance** æ ‡ç­¾
3. ç‚¹å‡»å½•åˆ¶æŒ‰é’®ï¼ˆåœ†åœˆï¼‰
4. åˆ·æ–°é¡µé¢
5. åœæ­¢å½•åˆ¶
6. åˆ†ææ—¶é—´çº¿ï¼Œæ‰¾å‡ºè€—æ—¶çš„æ“ä½œ

### 2. æ£€æŸ¥ Next.js ç¼–è¯‘æ—¶é—´

åœ¨ç»ˆç«¯æŸ¥çœ‹ Turbopack çš„è¾“å‡ºï¼š

```bash
# æŸ¥çœ‹ç¼–è¯‘æ—¶é—´
pnpm dev

# è¾“å‡ºç±»ä¼¼ï¼š
# âœ“ Ready in 1.2s
# â—‹ Compiling / ...
# âœ“ Compiled in 234ms
```

**æ­£å¸¸æŒ‡æ ‡ï¼š**
- é¦–æ¬¡å¯åŠ¨ï¼š30ç§’ - 2åˆ†é’Ÿ
- çƒ­æ›´æ–°ç¼–è¯‘ï¼š< 500ms
- é¡µé¢å¯¼èˆªï¼š< 1ç§’

### 3. æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—ï¼š

```typescript
// åœ¨ä»»æ„ API è·¯ç”±æˆ–æœåŠ¡å™¨ç»„ä»¶ä¸­
const start = Date.now();
const result = await db().query.users.findMany();
console.log(`Query took ${Date.now() - start}ms`);
```

**æ­£å¸¸æŒ‡æ ‡ï¼š**
- ç®€å•æŸ¥è¯¢ï¼š< 50ms
- å¤æ‚æŸ¥è¯¢ï¼š< 200ms
- è¶…è¿‡ 500msï¼šéœ€è¦ä¼˜åŒ–

### 4. ä½¿ç”¨ Next.js Bundle Analyzer

æŸ¥çœ‹å“ªäº›ä¾èµ–åŒ…å ç”¨ç©ºé—´å¤§ï¼š

```bash
# åˆ†ææ‰“åŒ…ä½“ç§¯
ANALYZE=true pnpm build

# ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨æ˜¾ç¤ºåˆ†æç»“æœ
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### é’ˆå¯¹ 3 ç§’åŠ è½½æ—¶é—´çš„ä¼˜åŒ–æ–¹æ¡ˆ

#### ä¼˜å…ˆçº§ 1ï¼šç«‹å³ä¼˜åŒ–ï¼ˆå·²å®Œæˆ âœ…ï¼‰

- [x] å¢åŠ æ•°æ®åº“è¿æ¥æ± åˆ° 10
- [x] ç¡®è®¤ Turbopack ç¼“å­˜å·²å¯ç”¨

#### ä¼˜å…ˆçº§ 2ï¼šæ£€æŸ¥æ…¢æŸ¥è¯¢

1. **æ£€æŸ¥é¦–é¡µæ˜¯å¦æœ‰æ…¢æŸ¥è¯¢**

   æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œåœ¨ Network æ ‡ç­¾ä¸‹æŸ¥çœ‹ API è¯·æ±‚ï¼š
   - æ‰¾å‡ºè€—æ—¶è¶…è¿‡ 500ms çš„è¯·æ±‚
   - ä¼˜åŒ–å¯¹åº”çš„æ•°æ®åº“æŸ¥è¯¢

2. **æ·»åŠ æ•°æ®åº“ç´¢å¼•**

   å¦‚æœå‘ç°æŸäº›æŸ¥è¯¢å¾ˆæ…¢ï¼Œè€ƒè™‘æ·»åŠ ç´¢å¼•ï¼š
   ```sql
   -- ç¤ºä¾‹ï¼šä¸ºç”¨æˆ·é‚®ç®±æ·»åŠ ç´¢å¼•
   CREATE INDEX idx_users_email ON users(email);
   ```

#### ä¼˜å…ˆçº§ 3ï¼šä»£ç å±‚é¢ä¼˜åŒ–

1. **ä½¿ç”¨ React Server Components**

   ç¡®ä¿æ•°æ®è·å–åœ¨æœåŠ¡å™¨ç«¯å®Œæˆï¼š
   ```tsx
   // âœ… å¥½çš„åšæ³• - Server Component
   async function UserList() {
     const users = await db().query.users.findMany();
     return <div>{/* render users */}</div>;
   }

   // âŒ é¿å… - Client Component ä¸­çš„æ•°æ®è·å–
   'use client';
   function UserList() {
     const [users, setUsers] = useState([]);
     useEffect(() => {
       fetch('/api/users').then(/* ... */);
     }, []);
   }
   ```

2. **ä½¿ç”¨ Suspense å’Œæµå¼æ¸²æŸ“**

   ```tsx
   import { Suspense } from 'react';

   export default function Page() {
     return (
       <div>
         <Suspense fallback={<div>Loading...</div>}>
           <SlowComponent />
         </Suspense>
       </div>
     );
   }
   ```

3. **å›¾ç‰‡ä¼˜åŒ–**

   ä½¿ç”¨ Next.js Image ç»„ä»¶ï¼š
   ```tsx
   import Image from 'next/image';

   // âœ… ä¼˜åŒ–å
   <Image
     src="/hero.jpg"
     width={800}
     height={600}
     priority // é¦–å±å›¾ç‰‡ä½¿ç”¨ priority
   />

   // âŒ é¿å…
   <img src="/hero.jpg" />
   ```

#### ä¼˜å…ˆçº§ 4ï¼šå›½é™…åŒ–ä¼˜åŒ–

å¦‚æœä¸éœ€è¦å¤šè¯­è¨€ï¼Œå¯ä»¥ä¸´æ—¶ç¦ç”¨ï¼š

```typescript
// next.config.mjs
const withNextIntl = createNextIntlPlugin({
  requestConfig: './src/core/i18n/request.ts',
});

// å¦‚æœåªç”¨ä¸€ç§è¯­è¨€ï¼Œå¯ä»¥è€ƒè™‘ç§»é™¤
```

---

## ğŸ¯ æ€§èƒ½åŸºå‡†

### å¼€å‘ç¯å¢ƒæœŸæœ›å€¼

| æŒ‡æ ‡ | æ­£å¸¸èŒƒå›´ | ä¼˜ç§€ | éœ€è¦ä¼˜åŒ– |
|------|---------|------|---------|
| é¦–æ¬¡å¯åŠ¨ | 30s - 2min | < 30s | > 3min |
| çƒ­æ›´æ–° | 500ms - 2s | < 500ms | > 3s |
| é¡µé¢å¯¼èˆª | 500ms - 1s | < 500ms | > 2s |
| API å“åº” | 100ms - 500ms | < 100ms | > 1s |
| æ•°æ®åº“æŸ¥è¯¢ | 50ms - 200ms | < 50ms | > 500ms |

### ä½ å½“å‰çš„æƒ…å†µ

- é¡µé¢åˆ·æ–°ï¼š**3ç§’** â†’ ç›®æ ‡ï¼š< 1ç§’
- æ”¹è¿›ç©ºé—´ï¼š**~2ç§’**

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¦‚æœä¼˜åŒ–åä»ç„¶æ…¢

#### 1. æ¸…ç†ç¼“å­˜

```bash
# æ¸…ç† Next.js ç¼“å­˜
rm -rf .next

# æ¸…ç† Turbopack ç¼“å­˜
rm -rf .next/cache

# é‡æ–°å¯åŠ¨
pnpm dev
```

#### 2. æ£€æŸ¥æ˜¯å¦æœ‰è¿›ç¨‹å ç”¨

```bash
# æŸ¥çœ‹ Node.js è¿›ç¨‹
ps aux | grep node

# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000

# å¦‚æœæœ‰å¤šä¸ª Next.js è¿›ç¨‹ï¼Œå…¨éƒ¨æ€æ‰åé‡å¯
killall node
pnpm dev
```

#### 3. æ£€æŸ¥ç³»ç»Ÿèµ„æº

```bash
# macOS æŸ¥çœ‹èµ„æºä½¿ç”¨
top

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
vm_stat

# å¦‚æœå†…å­˜ä¸è¶³ï¼Œè€ƒè™‘å¢åŠ  Node.js å†…å­˜
NODE_OPTIONS='--max-old-space-size=4096' pnpm dev
```

#### 4. æ£€æŸ¥æ•°æ®åº“è¿æ¥

```bash
# ç¡®ä¿ PostgreSQL æ­£åœ¨è¿è¡Œ
# å¦‚æœä½¿ç”¨ Supabase
supabase status

# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql postgresql://postgres:postgres@127.0.0.1:54322/postgres -c "SELECT 1;"
```

---

## ğŸ“ æµ‹è¯•ä¼˜åŒ–æ•ˆæœ

### é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
# é‡æ–°å¯åŠ¨
pnpm dev
```

### æµ‹è¯•æ­¥éª¤

1. **æµ‹è¯•é¦–æ¬¡åŠ è½½**
   - æ‰“å¼€ http://localhost:3000
   - è®°å½•åŠ è½½æ—¶é—´

2. **æµ‹è¯•çƒ­æ›´æ–°**
   - ä¿®æ”¹ä»»æ„ç»„ä»¶
   - ä¿å­˜æ–‡ä»¶
   - è§‚å¯Ÿé¡µé¢åˆ·æ–°é€Ÿåº¦

3. **æµ‹è¯•é¡µé¢å¯¼èˆª**
   - åœ¨ä¸åŒé¡µé¢é—´åˆ‡æ¢
   - è®°å½•å¯¼èˆªé€Ÿåº¦

### é¢„æœŸæ”¹è¿›

- **æ•°æ®åº“æŸ¥è¯¢**ï¼šåº”è¯¥ä» ~500ms é™åˆ° ~100ms
- **é¡µé¢åŠ è½½**ï¼šåº”è¯¥ä» 3ç§’ é™åˆ° 1-1.5ç§’
- **çƒ­æ›´æ–°**ï¼šåº”è¯¥åœ¨ 1ç§’å†…å®Œæˆ

---

## ğŸ“š è¿›é˜¶ä¼˜åŒ–

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

1. **å¯ç”¨ gzip/brotli å‹ç¼©**
2. **ä½¿ç”¨ CDN æ‰˜ç®¡é™æ€èµ„æº**
3. **å®ç° Redis ç¼“å­˜**
4. **æ•°æ®åº“è¯»å†™åˆ†ç¦»**
5. **ä½¿ç”¨è¾¹ç¼˜è®¡ç®—ï¼ˆCloudflare Workersï¼‰**

### ç›‘æ§å·¥å…·

- **Vercel Analytics** - ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ç›‘æ§
- **Sentry** - é”™è¯¯å’Œæ€§èƒ½è¿½è¸ª
- **Lighthouse** - ç½‘ç«™æ€§èƒ½è¯„åˆ†

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœæŒ‰ç…§æœ¬æŒ‡å—ä¼˜åŒ–åä»ç„¶é‡åˆ°æ€§èƒ½é—®é¢˜ï¼š

1. ä½¿ç”¨ Chrome DevTools Performance å½•åˆ¶æ€§èƒ½åˆ†æ
2. æ£€æŸ¥ç»ˆç«¯ä¸­çš„ Next.js ç¼–è¯‘æ—¥å¿—
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
4. è®°å½•å…·ä½“çš„åŠ è½½æ—¶é—´å’Œæ…¢çš„æ“ä½œ

---

æœ€åæ›´æ–°ï¼š2025-12-07
